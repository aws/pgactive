<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Global sequences and ORMs</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto: bdr-list@2ndquadrant.com"><LINK
REL="HOME"
TITLE="BDR 2.0.6 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Global Sequences"
HREF="global-sequences.html"><LINK
REL="PREVIOUS"
TITLE="Global sequence limitations"
HREF="global-sequence-limitations.html"><LINK
REL="NEXT"
TITLE="Global sequence voting"
HREF="global-sequence-voting.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="website-docs.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"><META
NAME="creation"
CONTENT="2023-04-11T13:16:52"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>BDR 2.0.6 Documentation</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Global sequence limitations"
HREF="global-sequence-limitations.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="global-sequences.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Chapter 10. Global Sequences</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Global sequence voting"
HREF="global-sequence-voting.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GLOBAL-SEQUENCES-ORMS"
>10.5. Global sequences and ORMs</A
></H1
><P
>   Some applications and <ACRONYM
CLASS="ACRONYM"
>ORM</ACRONYM
> (Object-Relational Mapper) tools
   expect to call <TT
CLASS="LITERAL"
>nextval</TT
> on a sequence directly, rather than using
   the table's declared <TT
CLASS="LITERAL"
>DEFAULT</TT
> for a column. If such an ORM is
   configured to recognise a sequence default for a column (like
   JPA/Hibernate's <TT
CLASS="LITERAL"
>@SequenceGenerator</TT
>) or auto-detects it (like
   Rails/ActiveRecord's default <TT
CLASS="LITERAL"
>id</TT
> magic) and assumes that it can
   get new values with <TT
CLASS="LITERAL"
>nextval(...)</TT
> without checking the table's
   actual <TT
CLASS="LITERAL"
>DEFAULT</TT
>, it will produce values using the underlying
   sequence not the BDR global sequence. This will very likely result in
   conflicts.You'll have to change/override this, or get them to fetch generated
   IDs from the database after insert, which most support. Also many ORMs assume 
   that nextval will return some 'n' values, like an increment of 50. They can't
   do that with global sequences. Make sure their increment is 1. 
  </P
><P
>   Application developers should configure these tools to fetch the
   database-generated default instead of using a sequence cache, or to call
   the correct <CODE
CLASS="FUNCTION"
>bdr.global_seq_nextval</CODE
> function to generate a
   value. The application may not assume a block of IDs has been generated, as
   if an increment was set, and may only use the actual value returned.
  </P
><P
>   Alternately, the DBA may choose to create a new schema (say
   <TT
CLASS="LITERAL"
>bdr_seq</TT
>), add wrapper functions for
   <TT
CLASS="LITERAL"
>nextval(regclass)</TT
> and <TT
CLASS="LITERAL"
>nextval(text)</TT
> there that call
   <TT
CLASS="LITERAL"
>bdr.global_seq_nextva(regclass)</TT
>, and ensure that the
   application's <TT
CLASS="LITERAL"
>search_path</TT
> puts the new schema
   <TT
CLASS="LITERAL"
>bdr_seq</TT
> <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>before</I
></SPAN
> <TT
CLASS="LITERAL"
>pg_catalog</TT
>.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="global-sequence-limitations.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="global-sequence-voting.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Global sequence limitations</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="global-sequences.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Global sequence voting</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>