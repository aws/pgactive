<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Full table rewrites</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto: bdr-list@2ndquadrant.com"><LINK
REL="HOME"
TITLE="BDR 2.0.6 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Technical notes"
HREF="technotes.html"><LINK
REL="PREVIOUS"
TITLE="DDL locking details"
HREF="technotes-ddl-locking.html"><LINK
REL="NEXT"
TITLE="Index"
HREF="bookindex.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="website-docs.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"><META
NAME="creation"
CONTENT="2023-04-11T13:16:52"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>BDR 2.0.6 Documentation</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="DDL locking details"
HREF="technotes-ddl-locking.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="technotes.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Appendix C. Technical notes</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Index"
HREF="bookindex.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="TECHNOTES-REWRITES"
>C.3. Full table rewrites</A
></H1
><P
>   There are a number of reasons why BDR doesn't support DDL operations that
   perform full table rewrites.
  </P
><P
>   They tend to be very slow operations for which the <A
HREF="ddl-replication-advice.html#DDL-REPLICATION-LOCKING"
> global DDL lock</A
> must be held
   throughout. That's a long time to "stop the world".  They can be problematic
   for apps on standalone PostgreSQL for this reason, but it's worse on BDR due
   to the global DDL lock.
  </P
><P
>   Table rewrites discard replication origin and commit timestamp information
   that we need to ensure that conflict resolution is consistent across all
   nodes. There's currently no way to remap it.
  </P
><P
>   Finally, we can't guarantee that the rewrite will have the same results
   across all nodes unless the entire expression it uses is classified as
   immutable. This isn't currently checked for. Even seemingly safe
   defaults like <CODE
CLASS="FUNCTION"
>nextval(...)</CODE
> aren't safe because
   the order in which rows are processed by a table rewrite will be
   different on different nodes, so different rows will get a given
   generated value on each node.
  </P
><P
>   Because of the performance issues we recommend that table-rewriting
   operations be split up into multiple smaller operations and aren't
   prioritizing support for the subset of them that can be made safe; see
   <A
HREF="ddl-replication-statements.html#DDL-REPLICATION-HOW"
>How to work around restricted DDL</A
>.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="technotes-ddl-locking.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="bookindex.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>DDL locking details</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="technotes.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Index</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>