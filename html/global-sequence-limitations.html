<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Global sequence limitations</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto: bdr-list@2ndquadrant.com"><LINK
REL="HOME"
TITLE="BDR 2.0.6 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Global Sequences"
HREF="global-sequences.html"><LINK
REL="PREVIOUS"
TITLE="Using global sequences"
HREF="global-sequence-usage.html"><LINK
REL="NEXT"
TITLE="Global sequences and ORMs"
HREF="global-sequences-orms.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="website-docs.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"><META
NAME="creation"
CONTENT="2023-04-11T13:16:52"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>BDR 2.0.6 Documentation</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Using global sequences"
HREF="global-sequence-usage.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="global-sequences.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Chapter 10. Global Sequences</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Global sequences and ORMs"
HREF="global-sequences-orms.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GLOBAL-SEQUENCE-LIMITATIONS"
>10.4. Global sequence limitations</A
></H1
><P
>   A few limitations and caveats apply to global sequences at time of writing,
   in addition to those discussed in <A
HREF="global-sequences-when.html"
>when
   to use global sequences</A
>:
  </P
><P
>   There is no transparent remapping of local sequences to global sequences.
   Schemas and/or applications must be modified to explicitly call
   <CODE
CLASS="FUNCTION"
>bdr.global_seq_nextval(...)</CODE
> or use it as a
   <TT
CLASS="LITERAL"
>DEFAULT</TT
> for a column. (A future version may handle
   <TT
CLASS="TYPE"
>BIGSERIAL</TT
> automatically).
  </P
><P
>   Global sequences are 64-bits wide and need a <TT
CLASS="TYPE"
>bigint</TT
> or
   <TT
CLASS="TYPE"
>bigserial</TT
>. There is no 32-bit <TT
CLASS="TYPE"
>integer</TT
> version.
   Down-casting will not work.
  </P
><P
>   <CODE
CLASS="FUNCTION"
>currval(...)</CODE
> and <CODE
CLASS="FUNCTION"
>lastval()</CODE
> return
   the value of the underlying sequence, not the value generated by
   <CODE
CLASS="FUNCTION"
>bdr.global_seq_nextval(...)</CODE
>. Do not use them with global
   sequences. This is a particular concern with <ACRONYM
CLASS="ACRONYM"
>ORM</ACRONYM
>s; see
   <A
HREF="global-sequences-orms.html"
>Global sequences and ORMs</A
>.
  </P
><P
>   The <TT
CLASS="LITERAL"
>INCREMENT</TT
> option on a sequence used as input for global
   sequences is effectively ignored. This could be relevant for applications
   that do sequence ID caching, like many object-relational mapper
   (<ACRONYM
CLASS="ACRONYM"
>ORM</ACRONYM
>) tools, notably Hibernate. Because the sequence is
   time-based this has little practical effect since the sequence will have
   advanced to a new non-colliding value by the time the application can do
   anything with the cached values.
  </P
><P
>   There is a limit of 8192 sequence values generated per millisecond on any
   given node for any given sequence. If more than 8192 sequences per
   millisecond are generated from one sequence on one node, the generated
   values will wrap around and collide. This will usually result in a
   <TT
CLASS="LITERAL"
>UNIQUE</TT
> constraint violation on <TT
CLASS="LITERAL"
>INSERT</TT
> or
   <TT
CLASS="LITERAL"
>UPDATE</TT
>. It cannot cause a replication conflict because
   sequence values generated on different nodes can <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>never</I
></SPAN
> collide.
  </P
><P
>   In practice this is harmless since values are not generated fast enough
   to trigger this limitation. Generating a single ID typically takes over 3ns,
   so 8192 per ms is exceedingly unlikely especially since there will be other
   work being done, rows inserted, indexes updated, etc. Despite that,
   applications should have a <TT
CLASS="LITERAL"
>UNIQUE</TT
> constraint in place where they
   absolutely rely on lack of collisions.
  </P
><P
>   Similarly, the <TT
CLASS="LITERAL"
>MINVALUE</TT
>, <TT
CLASS="LITERAL"
>MAXVALUE</TT
> and
   <TT
CLASS="LITERAL"
>CACHE</TT
> settings may be changed on the underlying sequence, but
   there is no benefit to doing so. The sequence's low 14 bits are used and the
   rest is discarded, so the value range limits don't affect the function's
   result. For the same reason, <CODE
CLASS="FUNCTION"
>setval(...)</CODE
> is not useful for
   sequences used with <CODE
CLASS="FUNCTION"
>bdr.global_sequence_nextval(..)</CODE
>.
  </P
><P
>   The <TT
CLASS="LITERAL"
>CACHE</TT
> directive may be used as normal. Because the
   sequence is time-based there's no point trying to avoid "unnecessary"
   sequence increments, though.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="global-sequence-usage.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="global-sequences-orms.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Using global sequences</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="global-sequences.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Global sequences and ORMs</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>