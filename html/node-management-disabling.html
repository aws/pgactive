<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Completely removing BDR</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto: bdr-list@2ndquadrant.com"><LINK
REL="HOME"
TITLE="BDR 2.0.6 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Node Management"
HREF="node-management.html"><LINK
REL="PREVIOUS"
TITLE="Parting (removing) a node"
HREF="node-management-removing.html"><LINK
REL="NEXT"
TITLE="n-safe synchronous replication"
HREF="node-management-synchronous.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="website-docs.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"><META
NAME="creation"
CONTENT="2023-04-11T13:16:52"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>BDR 2.0.6 Documentation</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Parting (removing) a node"
HREF="node-management-removing.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="node-management.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. Node Management</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="n-safe synchronous replication"
HREF="node-management-synchronous.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="NODE-MANAGEMENT-DISABLING"
>5.3. Completely removing BDR</A
></H1
><P
>   To take a BDR node that has already been parted, or one that has been
   restored from a base backup, and turn it back into a normal PostgreSQL
   database you may use the
   <A
HREF="functions-node-mgmt.html#FUNCTION-BDR-REMOVE-BDR-FROM-LOCAL-NODE"
>bdr.remove_bdr_from_local_node</A
> function.
  </P
><P
>   After running <TT
CLASS="LITERAL"
>bdr.remove_bdr_from_local_node()</TT
> it is safe
   to <TT
CLASS="LITERAL"
>DROP EXTENSION bdr;</TT
>. At this point all BDR-specific
   elements will have been removed from the local database and it may be used
   as a standalone database. Global sequences are converted into local
   sequences and may be used normally. All BDR triggers, event triggers,
   security labels, slots, replication identifiers etc are removed from
   the local node.
  </P
><P
>   Alternately, after <TT
CLASS="LITERAL"
>bdr.remove_bdr_from_local_node()</TT
>, it
   is possible to <A
HREF="functions-node-mgmt.html#FUNCTION-BDR-GROUP-CREATE"
>bdr.bdr_group_create</A
>
   a new BDR group with this database as the starting node. The new group will
   be completely independent from the existing group.
  </P
><DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Warning</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>    Note that
    local sequences are <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>not</I
></SPAN
> converted back to global sequences when a new node
    group is created. If converted using
    </P><PRE
CLASS="PROGRAMLISTING"
>    ALTER SEQUENCE ... USING bdr;
    </PRE
><P>
    the sequence will <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>not</I
></SPAN
> restart at the old local sequence
    startpoint. Nor can you use <CODE
CLASS="FUNCTION"
>setval(...)</CODE
> to advance it.
    It is currently necessary to use a script to call <CODE
CLASS="FUNCTION"
>nextval()</CODE
>
    repeatedly until the desired value is reached. (See github #215).
   </P
></TD
></TR
></TABLE
></DIV
><P
>   If BDR thinks it's still joined with an existing node group then
   <TT
CLASS="LITERAL"
>bdr.remove_bdr_from_local_node()</TT
> will refuse to run as a
   safety measure to prevent inconsistently removing a running node.
  </P
><P
>   If you are sure the node has really been parted from its group or is a
   duplicate copy of a node that's still running normally, you may force
   removal by calling <TT
CLASS="LITERAL"
>bdr.remove_bdr_from_local_node(true)</TT
>.
   Do <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>not</I
></SPAN
> do so unless you're certain the node you're
   running it on is already isolated from the group - say, if it's been parted
   while disconnected, or has been restored from a PITR backup or disk
   snapshot. Otherwise you will leave dangling replication slots etc on the
   other nodes, causing problems on the remaining nodes. Always <A
HREF="functions-node-mgmt.html#FUNCTION-BDR-PART-BY-NODE-NAMES"
>bdr.bdr_part_by_node_names</A
> the node first.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="node-management-removing.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="node-management-synchronous.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Parting (removing) a node</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="node-management.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>n-safe synchronous replication</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>