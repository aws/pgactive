<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Purpose of global sequences</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto: bdr-list@2ndquadrant.com"><LINK
REL="HOME"
TITLE="BDR 2.0.6 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Global Sequences"
HREF="global-sequences.html"><LINK
REL="PREVIOUS"
TITLE="Global Sequences"
HREF="global-sequences.html"><LINK
REL="NEXT"
TITLE="When to use global sequences"
HREF="global-sequences-when.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="website-docs.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"><META
NAME="creation"
CONTENT="2023-04-11T13:16:52"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>BDR 2.0.6 Documentation</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Global Sequences"
HREF="global-sequences.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="global-sequences.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Chapter 10. Global Sequences</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="When to use global sequences"
HREF="global-sequences-when.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GLOBAL-SEQUENCES-PURPOSE"
>10.1. Purpose of global sequences</A
></H1
><P
>   Many applications require unique values be assigned to database entries. Some
   applications use <SPAN
CLASS="APPLICATION"
>UUID</SPAN
>s/<SPAN
CLASS="APPLICATION"
>GUID</SPAN
>s generated by external
   programs, some use database-supplied values. This is important with
   optimistic conflict resolution schemes (like that in BDR) because
   uniqueness violations can result in discarded inserts during conflict
   resolution.
  </P
><P
>   The SQL standard requires <TT
CLASS="LITERAL"
>SEQUENCE</TT
> objects which generate
   unique values.  These can then be used to supply default values using
   <TT
CLASS="LITERAL"
>DEFAULT nextval('mysequence')</TT
>, as with PostgreSQL's
   <TT
CLASS="LITERAL"
>SERIAL</TT
> pseudo-type. PostgreSQL doesn't provide
   any facilities to synchronise or replicate sequences, so they're purely
   node-local.
  </P
><P
>   A typical approach for sharded or multi-node applications is to use
   split-step or partitioned sequences, where all nodes increment the sequence
   by the same fixed value and each node has a fixed offset within the sequence.
   So node 1 generates IDs 1, 101, 201, 301, ...; node 2 generates IDs 2, 102,
   202, 302, ...; etc. This is easily done with PostgreSQL's existing sequences,
   but becomes a major problem if you don't allow enough room for growth - in
   the above, if you have 101 nodes you're in serious trouble. It's also
   awkward, requiring node-specific DDL and setup. It also makes replacing
   failed nodes difficult as each table must be scanned to determine what ID
   each sequence was up to on the node before failure, or a new (very finite)
   node ID must be allocated. See <A
HREF="global-sequences-alternatives.html"
>Section 10.7</A
>.
  </P
><P
>   To help avoid <A
HREF="conflicts.html"
>Multi-master conflicts</A
> on concurrent inserts BDR
   provides a global sequence mapping function. This allows a normal sequence
   to be used in a globally-unique manner by qualifying its result with a
   unique node ID and timestamp. See <A
HREF="global-sequence-usage.html"
>Using global sequences</A
>.
  </P
><P
>   BDR manages the node IDs internally (see <A
HREF="catalog-bdr-nodes.html"
>the <TT
CLASS="LITERAL"
>bdr.bdr_nodes.node_seq_id</TT
>
   column</A
>). Node IDs for parted nodes are re-used, so node ID exhaustion
   is not a concern for environments that regularly part and join nodes, such
   as for load balancing.
  </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Note: </B
>    BDR 1.0 provided a different implementation of global sequences with different
    syntax and behaviour. See <A
HREF="global-sequences-bdr10.html"
>BDR 1.0 Global Sequences</A
>.
   </P
></BLOCKQUOTE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="global-sequences.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="global-sequences-when.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Global Sequences</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="global-sequences.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>When to use global sequences</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>