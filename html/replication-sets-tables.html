<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Table Replication Control</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto: bdr-list@2ndquadrant.com"><LINK
REL="HOME"
TITLE="BDR 2.0.6 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Replication Sets"
HREF="replication-sets.html"><LINK
REL="PREVIOUS"
TITLE="Node Replication Control"
HREF="replication-sets-nodes.html"><LINK
REL="NEXT"
TITLE="Change-type replication sets"
HREF="replication-sets-changetype.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="website-docs.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"><META
NAME="creation"
CONTENT="2023-04-11T13:16:52"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>BDR 2.0.6 Documentation</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Node Replication Control"
HREF="replication-sets-nodes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="replication-sets.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Chapter 11. Replication Sets</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Change-type replication sets"
HREF="replication-sets-changetype.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="REPLICATION-SETS-TABLES"
>11.4. Table Replication Control</A
></H1
><P
>   A newly created table is initially part of replication set
   <TT
CLASS="LITERAL"
>default</TT
>. It is assigned to more or different sets
   by <A
HREF="functions-replication-sets.html#FUNCTION-BDR-TABLE-SET-REPLICATION-SETS"
>bdr.table_set_replication_sets</A
>.
   This operation aquires a DDL lock and can be used in a fully functional
   <SPAN
CLASS="PRODUCTNAME"
>BDR</SPAN
> cluster with no down/missing members.
  </P
><P
>   The array of sets a table is part of is retrieved by
   <A
HREF="functions-replication-sets.html#FUNCTION-BDR-TABLE-GET-REPLICATION-SETS"
>bdr.table_get_replication_sets</A
>.
  </P
><P
>   Adding a table to a replication set does <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>not</I
></SPAN
>
   synchronize the table's contents to nodes that were not previously receiving
   changes for that table and will now do so. This means the table remains
   inconsistent across nodes. It is generally necessary for the administrator
   to manually synchronize the table after adding it to a replication set. The
   simplest way to do this, albeit inefficiently and only if there are no
   foreign keys references to the table, is to start a transaction, copy the
   table's contents to a temp table, truncate the original table, copy the
   table's contents back to the original table, and commit. Alternately, the
   admin may use <SPAN
CLASS="APPLICATION"
>psql</SPAN
>'s <TT
CLASS="LITERAL"
>\copy</TT
>
   with <A
HREF="bdr-configuration-variables.html#GUC-BDR-DO-NOT-REPLICATE"
>bdr.do_not_replicate</A
> to (carefully!) sync the
   newly-replicated table's contents to the receiving node, typically
   by joining two <SPAN
CLASS="APPLICATION"
>psql</SPAN
> sessions with a pipe.
   A future BDR release will add a built-in facility to consistently
   resynchronize a table.
  </P
><P
>   Removing a table from a replication set does not cause it to be emptied
   on nodes that will no longer receive changes to it. On those nodes the
   table just stops getting new changes, so it's frozen in time.
  </P
><P
>   Table replication set membership changes take effect only for writes
   performed after the set change. Any nodes still replaying old changes
   due to replication lag/delay will continue to receive them with the prior
   replication set memberships until they replay up to the point in the logical
   change history where the replication set memberships changed. This means
   you can't change a table's replication sets to get a node to skip over
   a lot of write activity after the fact. (However, if the table was already
   in some different replication set, you <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>can</I
></SPAN
> change
   which replication sets the node replays from to skip that set, since
   node replication set memberships take immediate effect).
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="replication-sets-nodes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="replication-sets-changetype.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Node Replication Control</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="replication-sets.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Change-type replication sets</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>